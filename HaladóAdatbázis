---ELSŐ ÓRA---SQL---

Felhasználónév: u__neptunkód

/*------------------------------------------- 
  Note
  Jelszó csere:
  alter user felhnev identified by jelszó; 
*/-------------------------------------------

___SZERELŐ SÉMA___
1. FELADAT: Listázzuk a debreceni tulajdonosok nevét és címét.

select nev, cim from SZERELO.sz_tulajdonos
where cim like 'Debrecen, %';

2. FELADAT: Listázzuk az Opel, Ford és Skoda márkájú autótípusok megnevezését

select megnevezes
from SZERELO.sz_autotipus
where marka in ('Opel', 'Skoda', 'Ford');

3. FELADAT: Piros színű autók rendszáma, típus, márkája.

select rendszam, megnevezes, marka
from szerelo.sz_auto au
left outer join szerelo.sz_autotipus ati
on au.tipus_azon=ati.azon
where szin='piros';

4. FELADAT: Féktelenül BT vezetője?

select sz.nev
from szerelo.sz_szerelo sz
inner join szerelo.sz_szerelomuhely szm
on sz.azon=szm.vezeto_azon
where szm.nev='Féktelenül Bt.';

5. FELADAT: Egyes autók típusai. (rendszám, márka)

select rendszam, marka, megnevezes
from szerelo.sz_auto au
left outer join szerelo.sz_autotipus ati
on au.tipus_azon=ati.azon;

6. FELADAT: Egyes márkákhoz hány típus tartozik.

select marka, count(*)
from szerelo.sz_autotipus ati
inner join szerelo.sz_auto au
on ati.azon=au.tipus_azon
group by marka;

7. FELADAT: Melyek azok a színek, amelyekhez 3-nál több autó tartozik?

select szin, count(*)
from szerelo.sz_auto
group by szin 
having count(*)>3;

8. FELADAT: Melyek azok az autók, amelyeket 3-nál többször szereltek?

select rendszam, au.azon, count(*)
from szerelo.sz_auto au
inner join szerelo.sz_szereles sz
on au.azon=sz.auto_azon
group by rendszam, au.azon
having count(*)>3;

9. FELADAT:  Melyek azok az autók, amelyeket 3-nál kevesebbszer szereltek?

select rendszam, au.azon, count(auto_azon)
from szerelo.sz_auto au
left outer join szerelo.sz_szereles sz
on au.azon=sz.auto_azon
group by rendszam, au.azon
having count(auto_azon)}<3;

// Nem teljesen jó, valami hiba van, nem fut le

10. FELADAT: Az egyes tulajdonosoknak hány autója van?ű

select nev, tu.azon, count(auto_azon)
from szerelo.sz_tulajdonos tu
left outer join
szerelo.sz_auto_tulajdonosa atu
on tu.azon=atu.tulaj_azon
group by nev, tu.azon;

11. FELADAT: Melyik szerelőműhelyben szereltek 65-nél kevesebb különböző autót?

select szm.nev, szm.azon count(sz.auto_azon)
from szerelo.sz_szerelomuhely szm
left outer join 
szerelo.sz_szereles sz
on szm.azon=sz.muhely_azon
group by szm.nev, szm.azon
having count(sz.auto_azon)<65;

//Megint gebaszos



---MÁSODIK ÓRA---SQL---

1. FELADAT: A legolcsóbb első vásárlási árú autó rendszáma?

//Beágyazott SELECT, mert a ROWNUM nem jó, ha 2 egyforma értékű is van

select rendszam, elso_vasarlasi_ar
from szerelo.sz_auto
where elso_vasarlasi_ar=(select min(elso_vasarlasi_ar) from SZERELO.sz_auto);

//BEÁGYAZOTT SELECT NÉLKÜL (fetch first row with ties)

select rendszam, elso_vasarlasi_ar
from szerelo.sz_auto
order by elso_vasarlasi_ar
fetch first row with ties;

//CREATE TABLE
create table s_auto2
(rendszam varchar2(20),
ar number(10),
szin varchar2(20));

2. FELADAT: Melyik auto (rendszám) értékelték fel a legtöbbször?

select rendszam, au.azon, count(*) db
from SZERELO.sz_auto au 
inner join SZERELO.sz_autofelertekeles af
on au.azon=af.auto_azon
group by au.rendszam, au.azon
order by db desc
fetch first row with ties;

3. FELADAT: Melyik auto (rendszám) értékelték fel a legkevesebbszer?

select rendszam, au.azon, count(datum) db
from SZERELO.sz_auto au 
left outer join SZERELO.sz_autofelertekeles af
on au.azon=af.auto_azon
group by au.rendszam, au.azon
order by db
fetch first row with ties;

4 FELADAT: Piros autók közül melyik a legolcsóbb? 

select rendszam, azon, elso_vasarlasi_ar
from SZERELO.sz_auto
where szin like 'piros'
order by elso_vasarlasi_ar
fetch first row with ties;

5. FELADAT: Színenként a legnagyobb első vásárlási árú autók rendszáma?

select *
from szerelo.sz_auto au inner join
(select szin, max(elso_vasarlasi_ar) eva
from szerelo.sz_auto
group by szin)bs
on (au.szin=bs.szin or (au.szin is null and bs.szin is null))
and au.elso_vasarlasi_ar=bs.eva;

6. FELADAT: Autóként a legnagyobb munkavégzési árral rendelkező szerelés paraméterei
                                                                 (kezdete, vége, műhely azon)?

select auk.rendszam, szk.muhely_azon, szk.szereles_kezdete,
szk.szereles_vege, szk.munkavegzes_ara
from szerelo.sz_auto auk 
left outer join szerelo.sz_szereles szk
on auk.azon=szk.auto_azon
inner join
    (select au.azon, max(munkavegzes_ara) mar
    from szerelo.sz_auto au left outer join szerelo.sz_szereles sz
    on au.azon=sz.auto_azon
    group by au.azon) bs
on (auk.azon=bs.azon or (auk.azon is null and bs.azon is null))
and (szk.munkavegzes_ara=bs.mar or (szk.munkavegzes_ara is null and

//Na hogy ez mi a faszom???

7. FELADAT: Egyes tulajdonosok melyik autót vásárolták utoljára?

select *
from SZERELO.sz_tulajdonos tu
left outer join 
    (select *
    from szerelo.sz_auto_tulajdonosa
    where (tulaj_azon, vasarlas_ideje) in
        (select tulaj_azon, max(vasarlas_ideje)
        from SZERELO.sz_auto_tulajdonosa
        group by tulaj_azon)) bs
on tu.azon=bs.tulaj_azon
left outer join szerelo.sz_auto au
on bs.auto_azon=au.azon;

//Ez sem szebb


















































